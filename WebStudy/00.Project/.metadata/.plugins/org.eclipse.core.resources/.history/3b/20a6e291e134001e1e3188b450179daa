package user;
 
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
 
 
public class UserDAO {
    
    private Connection conn;            // DB에 접근하는 객체
    private PreparedStatement pstmt;    // 
    private ResultSet rs;                // DB data를 담을 수 있는 객체  (Ctrl + shift + 'o') -> auto import
    
	public void getConnection() {
			
			try {
				Class.forName("oracle.jdbc.driver.OracleDriver");
		 	
				String db_url = "jdbc:oracle:thin:@project-db-stu3.smhrd.com:1524:xe";
				String db_id = "Insa4_Spring_hacksim_5";
				String db_pw = "aishcool5";
				
				conn = DriverManager.getConnection(db_url, db_id, db_pw);
				
			} catch (ClassNotFoundException e) {
				e.printStackTrace();
				System.err.println("ojdbc6.jar 또는 경로를 체크하세요!");
			} catch (SQLException e) {
				e.printStackTrace();
				System.err.println("DB연결에 필요한 정보가 맞는지 체크하세요!");
			}
		}
    
	public void close() {
		try {
			if (rs != null) {
				rs.close();
			}
			if (pstmt != null) {
				pstmt.close();
			}
			if (conn != null) {
				conn.close();	
			}
		}catch (SQLException e) {
			e.printStackTrace();
		}
	}
	
    public UserDAO(){ 
        try {
        	Class.forName("oracle.jdbc.driver.OracleDriver");
    	 	
        	String db_url = "jdbc:oracle:thin:@project-db-stu3.smhrd.com:1524:xe";
			String db_id = "Insa4_Spring_hacksim_5";
			String db_pw = "aishcool5";
			
			conn = DriverManager.getConnection(db_url, db_id, db_pw);
            
        } catch (Exception e) {
            e.printStackTrace();
        }
        
    }
    
    public int login(String userID, String userPassword) {
    	getConnection();
    	
        String SQL = "SELECT 이름 FROM TB_MEMBER WHERE 아이디 = ?";
        try {
            pstmt = conn.prepareStatement(SQL);
            pstmt.setString(1, userID);
            rs = pstmt.executeQuery();
            if(rs.next()){
                if(rs.getString(1).equals(userPassword))
                    return 1;    // 로그인 성공
                else
                    return 0; // 비밀번호 불일치
            }
            return -1; // ID가 없음
            
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
        	close();
        }
        return -2; // DB 오류
        
    }
    
    public int join(UserDTO user) {
    	getConnection();
    	
    	int cnt = 0;
    	
        String SQL = "INSERT INTO USERS VALUES (?, ?, ?, ?, ?)";
        try {
            pstmt = conn.prepareStatement(SQL);
            pstmt.setString(1, user.getUserID());
            pstmt.setString(2, user.getUserP());
            pstmt.setString(3, user.getUserName());
            pstmt.setString(4, user.getUserGender());
            pstmt.setString(5, user.getUserEmail());
            cnt = pstmt.executeUpdate();
        } catch(Exception e) {
            e.printStackTrace();
        } finally {
        	close();
        }
        return cnt; // 데이터베이스 오류
    }
 
}

